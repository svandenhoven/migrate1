{{ if .Context.File }}
  {{ if .Context.File.Section }}
    {{ $section := .Context.File.Section }}

    <!-- Load Git info from products.yaml based on the page Section -->
    {{ $productData := index .productsYaml "products" }}
    {{ $sectionData := index $productData $section }}
    {{ if not $sectionData }}
      <!-- If the page Section does not match a key in products.yaml, it's a page from the "gitlab" project -->
      {{ $sectionData = index $productData "gitlab" }}
      {{ $section = "gitlab" }}
    {{ end }}

    {{ if $sectionData }}
      {{ $page_path := .Context.File.Path }}
      {{ if ne $section "gitlab" }}
        <!-- Drop the redundant section name for non-gitlab pages -->
        {{ $page_path = strings.TrimLeft "/" (replace $page_path $section "" 1) }}
      {{ end }}

      {{ $edit_base_url := "" }}

      {{ $project := replace (replace $sectionData.repo "https://gitlab.com/" "") ".git" "" }}
      {{ $default_branch := $sectionData.default_branch }}
      {{ $doc_dir := $sectionData.docs_dir }}

      {{ if eq .linkType "source" }}
        {{ $edit_base_url = printf "https://gitlab.com/%s/-/blob/%s/%s" $project $default_branch $doc_dir }}
      {{ else if eq .linkType "ide" }}
        {{ $edit_base_url = printf "https://gitlab.com/-/ide/project/%s/edit/%s/-/%s" $project $default_branch $doc_dir }}
      {{ end }}

      <a href="{{ $edit_base_url }}/{{ $page_path }}">{{ .editText }}</a>
    {{ end }}
  {{ end }}
{{ end }}
